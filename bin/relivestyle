#!/usr/bin/env node

const wrap = require("@gustavnikolaj/async-main-wrap");
const yargs = require("yargs");

const cli = require("../lib/cli");

const configureArgs = () => yargs =>
  yargs
    .positional("directory", {
      type: "string"
    })
    .option("port", {
      type: "number",
      describe: "Optionally specify a port on which to run the server."
    });

const processArgs = () =>
  yargs
    .usage("$0 <directory>")
    .command(
      "* <directory>",
      "Start reliving styles from a the specified directory.",
      configureArgs()
    )
    .help().argv;

const processArgsAndExecute = cwd => {
  const argv = processArgs();
  return cli(cwd, argv).then(() => process.exit(0));
};

wrap(processArgsAndExecute)(process.cwd());
